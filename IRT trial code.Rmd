---
title: "IRT trial code"
author: "radhika"
date: "11/29/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}


library(tidyr)
library(dplyr)
library(stringr) 
library(ggplot2)
library(readr)
library(norm)
library(knitr)


#install.packages("psych")
library(psych)
library(mirt)


install.packages("lmtest")
library(lmtest)
```


## Objectives
1. Simulate a response dataset, using 1PL, 2 PL and 3PL

2. Estimate each model and check for fit:
a. Estimate item parameters using MLE for 1PL, 2PL and 3PL models
b. Compare model fit using LR (nested models), AIC and BIC (not nested)

###     I am not sure about how to do this part
3. Estimate model and check for fit using Bayesian methods 
a. Estimate item parameters using Bayesian parameter estimates
b. Compare model fit using cross-validation log likelihood (CVLL) and Deviance Information Criterion (DIC)




#Simulate dataset

#Kang and Cohen dataset sizes
## Study 1: 21 + 15 = 35 questions

```{r}


 #Set the seed and generate the parameters
 
#nitem=20
#sample.size=1000
#model="2PL"

##function to generate dataset
 
fun_simulate_data= function(nitem, sample.size, model) {
  set.seed(123)
  a <- as.matrix(round(rlnorm(nitem, meanlog = 0, sdlog = 1),3), ncol=1) #lognormal
  b <- as.matrix(round(rnorm(nitem, mean = 0, sd = 1),3), ncol=1) #normal
  c <- as.matrix(round(rbeta(nitem, shape1 = 5, shape2 = 17),3), ncol=1) #beta
 
  ability <- as.matrix(round(rnorm(sample.size, mean = 0, sd = 1),3), ncol=1) #normal

 #Simulate response data 
 	if (model == "1PL"){
 dat <- simdata(a = a, 
                d = b, 
                N = sample.size, 
                itemtype = 'dich', 
                guess = c, 
                Theta = ability)
 	}
 
 if (model == "2PL"){
 dat <- simdata(a = a, 
                d = b, 
                N = sample.size, 
                itemtype = '2PL', 
                guess = c, 
                Theta = ability)
 }
 
 if (model == "3PL"){
 dat <- simdata(a = a, 
                d = b, 
                N = sample.size, 
                itemtype = '3PL', 
                guess = c, 
                Theta = ability)
 }
 }
 

```


## Extract item parameters using different models


```{r}

model1PL <- mirt(data=dat, 1, itemtype='Rasch', SE=TRUE, verbose=FALSE)
model2PL <- mirt(data=dat, 1, itemtype='2PL', SE=TRUE, verbose=FALSE)
parameters <- as.data.frame(coef(model1PL, simplify=TRUE)$items)

lrtest (model1PL, model2PL)

```


 
 
 
 
 
## Calling functions

```{r}
# Generate a 1PL dataset


# Estimate parameters 
## using 1PL



## using 2PL


```


